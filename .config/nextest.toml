# Configuration for cargo-nextest
# https://nexte.st/book/configuration.html

# Enable experimental features
experimental = ["setup-scripts"]

[store]
# Store test results for analysis
dir = "target/nextest"

# Setup script to configure KDF parameters based on profile:
# - default/quick: fast KDF (N=1024, ~32x faster vault creation)
# - ci: production KDF (N=32768, real security parameters)
[scripts.setup.kdf-setup]
command = 'scripts/kdf-setup.sh'

[profile.default]
# Default test threads = number of CPUs
# For crypto tests with heavy I/O, this is usually optimal

# Retry flaky tests once
retries = 1

# Fail fast on first failure (can override with --no-fail-fast)
fail-fast = true

# Test timeout - crypto operations should complete quickly
slow-timeout = { period = "60s", terminate-after = 2 }

# Status output
status-level = "pass"
final-status-level = "flaky"

# Enable KDF setup for all tests
[[profile.default.scripts]]
filter = 'all()'
setup = 'kdf-setup'

[profile.default.junit]
# JUnit XML output for CI integration
path = "target/nextest/default/junit.xml"

[profile.ci]
# CI-specific settings
retries = 2
fail-fast = true

# More verbose output in CI
status-level = "all"

# KDF setup script automatically detects CI profile and uses production scrypt
# (inherited from default profile via [[profile.default.scripts]])

[profile.ci.junit]
path = "target/nextest/ci/junit.xml"

[profile.quick]
# Quick iteration during development
# Skip slow tests (those marked #[ignore])
retries = 0
fail-fast = true
